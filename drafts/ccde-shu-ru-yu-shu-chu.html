<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>salt fish on the moon</title>
	<meta name="description" content="">
	<meta name="author" content="fx-moon">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="/theme/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/local.css" rel="stylesheet">
	<link href="/theme/pygments.css" rel="stylesheet">

	<!-- Feeds -->




</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="/">salt fish on the moon</a>
			<ul class="nav">
						<li><a href="/pages/about.html">About</a></li>
					<li class="active"><a href="/category/note.html">note</a></li>
					<li ><a href="/category/record.html">record</a></li>
			</ul>
			<p class="pull-right"><a href="/archives.html">[archives]</a> <a href="/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="http://getpelican.com/">Pelican</a></li>
				<li><a href="http://python.org/">Python.org</a></li>
				<li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>C/C++的输入与输出</h1></div>
		<div class="well small">Permalink: <a class="more" href="/drafts/ccde-shu-ru-yu-shu-chu.html">2017-08-10 00:00:00+08:00</a>
by <a class="url fn" href="/author/fx-moon.html">fx-moon </a>
 in <a href="/category/note.html">note</a>
</div>
		<div><p>突然想研究一下C/C++的输入输出效率</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="center">传统C</th>
<th align="center">C++</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">输入</td>
<td align="center">scanf()</td>
<td align="center">std::cin</td>
</tr>
<tr>
<td align="left">输出</td>
<td align="center">printf()</td>
<td align="center">std::cout</td>
</tr>
<tr>
<td align="left">文件</td>
<td align="center">fread()</td>
<td align="center">fstream</td>
</tr>
</tbody>
</table>
<p>大体这样</p>
<p>引用别人的一些数据</p>
<tbody>
<tr style="background:rgb(250,250,250)">
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">方法/平台/时间(秒)</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">Linux gcc</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">Windows mingw</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">Windows VC2008</td>
</tr>
<tr>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">scanf</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">2.010</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">3.704</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">3.425</td>
</tr>
<tr style="background:rgb(250,250,250)">
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">cin</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">6.380</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">64.003</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">19.208</td>
</tr>
<tr>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">cin取消同步</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">2.050</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">6.004</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">19.616</td>
</tr>
<tr style="background:rgb(250,250,250)">
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">fread</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">0.290</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">0.241</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">0.304</td>
</tr>
<tr>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">read</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">0.290</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">0.398</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">不支持</td>
</tr>
<tr style="background:rgb(250,250,250)">
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">mmap</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">0.250</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">不支持</td>
<td style="border:1px solid rgb(238,238,238); padding:4px; text-align:left">不支持</td>
</tr>
</tbody>

<p>看到这个，我是不信的。。。</p>
<p>因为C++这么NB的东西怎么这么菜！</p>
<p>咳咳，因为cin在处理输入格式的时候是编译的时候预处理的，而scanf是运行时处理，理论上cin应该更快</p>
<p>不过数学告诉我们（划掉）<strong>C</strong>更快</p>
<p>C++：为什么会这样？明明是我先的，你们为什么这么熟练啊？</p>
<p>因为你脚踏两只船啊</p>
<p>cin在进行读取操作的同时，也在维护stdin的指针，使cin与scanf保持同步，而scanf可不管cin的死活，所以效率自然差距巨大。</p>
<p>那就让cin别管stdin咯</p>
<div class="highlight"><pre><span></span><span class="nt">ios</span><span class="p">::</span><span class="nd">sync_with_stdio</span><span class="o">(</span><span class="nt">false</span><span class="o">);</span>
</pre></div>


<p>表中的数据还是cin慢</p>
<p>我自己测了一下</p>
<p>WIN10 VS2017 x64 release</p>
<p>10000000个数</p>
<table>
<thead>
<tr>
<th align="left">函数</th>
<th align="right">时间</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">cin</td>
<td align="right">7.244</td>
</tr>
<tr>
<td align="left">cin(无同步)</td>
<td align="right">7.220</td>
</tr>
<tr>
<td align="left">scanf</td>
<td align="right">2.524</td>
</tr>
</tbody>
</table>
<p>结果相同</p>
<p>换linux</p>
<table>
<thead>
<tr>
<th align="left">函数</th>
<th align="right">时间</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">cin</td>
<td align="right">0.810</td>
</tr>
<tr>
<td align="left">cin(无同步)</td>
<td align="right">0.801</td>
</tr>
<tr>
<td align="left">scanf</td>
<td align="right">0.968</td>
</tr>
</tbody>
</table>
<p>询问了一下老师，老师的解释是系统实现以及编译器优化的问题</p>
<p>大概是编译器自动把同步关掉了ε=ε=ε=┏(゜ロ゜;)┛</p>
<p>注：在读取大量数据使用更底层的read更快</p></div>
	</div>
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; fx-moon</p>
		</footer>
	  </div>

	</div>
</body>
</html>